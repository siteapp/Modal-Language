<head>
    <title>beauty modal</title>
</head>

<body>
    <select name="Country" id="switch"></select>
    <select name="Language" id="languages">
        <option value="RU">RU</option>
        <option value="EN">EN</option>
    </select>
    <select name="currents" id="currents">
        <option value="EUR">EUR</option>
        <option value="USD">USD</option>
        <option value="RUB">RUB</option>
    </select>
    
    <div>
        <div id="country">AF</div>
        <div id="language">RU</div>
        <div id="current">EUR</div>
    </div>
    <script type="text/javascript" language="javascript">
        //получаем идентификатор элемента
        var a = document.getElementById('switch'),
            b = document.getElementById('languages'),
            с = document.getElementById('currents'),
            modalData = [],
            dataArray = [],
            //Получение массива из локалки
            userData = JSON.parse(localStorage.getItem("UserData"));

        fetch('https://beautyhub.pro/ajax/country_ajax.php')
        .then((response) => {
            return response.json();
        })
        .then((data) => {
            var countrys = data.map(function(country) {
                var name = country.name,
                    iso = country.iso,
                    lang = country.lang,
                    current_name = country.current_name,
                    id = country.id;

                let optionList = document.createElement('option');

                optionList.innerHTML = '[' + iso + '] '+ name +'';
                optionList.value = iso;
                optionList.setAttribute('lang', lang);
                optionList.setAttribute('current_name', current_name);
                optionList.setAttribute('id', id);
                optionList.setAttribute('name', name);
                a.append(optionList);

                dataArray.push({
                    'name': name,
                    'iso': iso,
                    'lang': lang,
                    'current_name': current_name,
                    'id': id
                });

                if(userData !== null){
                    if(iso == userData[0].country){
                        optionList.selected = true;
                    }
                }
            });
        });

        //дожидаемся полной загрузки страницы
        window.onload = function () {
            
            //Выбор страны
            a.onclick = function Countries () {
                document.getElementById('country').innerHTML = this.value;
                ModalData();
            }

            //Выбор языка
            b.onclick = function Language () {
                document.getElementById('language').innerHTML = this.value;
                ModalData();
            }

            //Выбор валюты
            с.onclick = function Currents () {
                document.getElementById('current').innerHTML = this.value;
                ModalData();
            }

            //Массив выбранных элементов
            function ModalData () {
                let country = document.getElementById('country').innerHTML,
                    language = document.getElementById('language').innerHTML,
                    current = document.getElementById('current').innerHTML;
                
                modalData.splice(0, modalData.length);
                modalData.push({
                    'country': country,
                    'language': language,
                    'current': current,
                });

                localStorage.setItem('UserData', JSON.stringify(modalData));
            }
        
            if(userData !== null){
                userDataCountry = userData[0].country;
                userDataLanguage = userData[0].language;
                userDataCurrent = userData[0].current;

                document.getElementById('country').innerHTML = userDataCountry;
                document.getElementById('language').innerHTML = userDataLanguage;
                document.getElementById('current').innerHTML = userDataCurrent;

                if('EN' == userDataLanguage){
                    b.querySelector('option[value='+ userDataLanguage +']').selected = true;
                }

                if('USD' == userDataCurrent){
                    document.getElementById('currents').querySelector('option[value='+ userDataCurrent +']').selected = true;
                } else if('RUB' == userDataCurrent) {
                    document.getElementById('currents').querySelector('option[value='+ userDataCurrent +']').selected = true;
                }

            }
            //console.log(userData)
        }
    </script>
</body>